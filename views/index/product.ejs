<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="/public/stylesheets/userStyle.css" />
    <link rel="preconnect" href="https://rsms.me/" />
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css" />
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.0.7/css/all.css"
    />
    <title><%=locals.documentTitle%> | TIMELESS</title>
    <style>
      .button-div:hover{
        color: white !important;
        font-weight: 400;
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2),
          0 6px 20px 0 rgba(0, 0, 0, 0.19);
          border:  1.4px solid white !important;
      }
      .button-div:active{
        color: white !important;
        font-weight: 400;
        box-shadow: inset 0 6px 10px 0 rgba(0, 0, 0, 0.2),
          0 6px 20px 0 rgba(0, 0, 0, 0.19);
      }
      #reviewButtomLeft, #reviewButtomRight{
        width: 3%;
      }
      .product-details {
        width: 80%;
      }
      @media all and (max-width: 768px) {
        .product-details {
          width: 100%;
        }
        #carouselIndicators{
          width: 100% !important;
        }
        #description{
          font-size: 85%;
        }
        #description h6{
          font-size: 80%;
        }
      }
      .product-details {
        background-image: url(/public/img/design/productPage/heroBG/<%=productDetails.color%>.jpg);
        min-height: 100px;
      }
      .heroIMG {
        border: 1px solid white;
      }
      .swal2-popup {
  font-size: 0.85rem !important;
}
.review-star {
  position: relative;
  display: inline-block;
  /* border: none; */
  font-size: 14px;
  /* margin: 50px auto; */
  /* left: 50%;
  transform: translateX(-50%); */
}

.review-star input {
  border: 0;
  width: 1px;
  height: 1px;
  overflow: hidden;
  position: absolute !important;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  opacity: 0;
}

.review-star label {
  position: relative;
  float: right;
  color: #C8C8C8;
}

.review-star label:before {
  margin: 3px;
  content: "‚òÖ";
  display: inline-block;
  font-size: 1.7em;
  color: #ccc;
  -webkit-user-select: none;
  -moz-user-select: none;
  user-select: none;
}

.review-star input:checked ~ label:before {
  color: #FFC107;
}

.review-star label:hover ~ label:before {
  color: #ffdb70;
}

.review-star label:hover:before {
  color: #FFC107;
}
@media screen and (min-width: 768px) {
  .card_wrap {
    display: flex;
  }
  .cardMargin {
    margin: 0.5em;
    width: calc(100% / 3);
  }
}
@media screen and (max-width: 768px) {
  .card:not(:first-child) {
    display: none;
  }
}
.card {
  border: none;
  border-radius: 0;
  box-shadow: 2px 6px 8px 0 rgba(22, 22, 26, 0.18);
}
.carousel-inner {
  padding: 1em;
}

.carousal-row {
  width: 79%;
}

    </style>
  </head>
  <body>
    <header>
      <div class="container-fluid header-top">
        <div class="container d-flex header-top-links justify-content-end">
          <a class="px-2 d-none d-lg-block" href="">Contact Us</a>
          <a class="px-2 d-none d-lg-block" href="">About Us</a>
        </div>
      </div>
      <nav
        class="container navbar navbar-expand-lg bg-white py-3 px-2 line-break"
      >
        <div class="container-fluid justify-content-around">
          <a class="navbar-brand d-flex align-items-center" href="/">
            <img
              src="/public/img/timeless-logo.png"
              alt="Logo"
              width="40"
              height="40"
              class="d-inline-block align-text-top"
            />
            <div class="brand-name ms-3">
              <span>TIMELESS</span>
            </div>
          </a>
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarText"
            aria-controls="navbarText"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarText">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0 align-items-center">
              <li class="nav-item mx-4 ms-lg-5">
                <a class="nav-link" href="/categories/63a051ff7b36d782859a1e3e">Men</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/categories/63a0523eceb514042442b2f4">Women</a>
              </li>
            </ul>
            <span class="nav-item nav-link text-center mb-2 mb-lg-0 mx-3">
              <a class="nav-link" href="/products">Our Collection</a>
            </span>
            <span class="nav-item nav-link text-center mb-2 mb-lg-0 mx-3">
              <a class="nav-link" href="/users/wishlist">Wishlist</a>
            </span>
            <span class="nav-item nav-link text-center mb-2 mb-lg-0 mx-3">
              <a class="nav-link" href="/users/cart">Cart</a>
            </span>
            <span class="nav-item nav-link text-center mb-2 mb-lg-0 ms-lg-3">
              <% if(locals.session){%>

              <div class="btn-group dropstart">
                <button
                  type="button"
                  class="btn btn-light dropdown-toggle"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                  style="
                    text-transform: uppercase;
                    letter-spacing: 2px;
                    color: grey;
                    font-weight: 600;
                  "
                >
                  <%=locals.currentUser.name%>
                </button>
                <ul class="dropdown-menu" style="font-size: 0.75rem">
                  <li>
                    <a class="dropdown-item" href="/users/profile">Profile</a>
                  </li>
                  <li>
                    <a class="dropdown-item" href="/users/orders">Orders</a>
                  </li>
                  <li>
                    <a class="dropdown-item" href="/users/addresses">Address</a>
                  </li>
                  <li><hr class="dropdown-divider" /></li>
                  <li>
                    <a class="dropdown-item" href="/users/signOut">Sign Out</a>
                  </li>
                </ul>
              </div>
              <% }else{%>
              <a class="nav-link" href="/users/signIn">Sign In</a>
              <%}%>
            </span>
          </div>
        </div>
      </nav>
    </header>
    <% if(productDetails != null){%>
    <section>
        <div class="brand-BG container d-flex flex-column align-items-center">
          <img
            src="/public/img/design/productPage/brandBG/<%=productDetails.color%>.png"
            alt=""
            width="100%"
            class="rounded mt-3"
          />
          <div
            class="product-details rounded row justify-content-around my-3 py-5 px-5"
          >
              <img
                src="/public/img/products/<%=productDetails.frontImage%>"
                alt=""
                
                width="100%"
                class="heroIMG rounded col-lg-5"
              />
            <div class="product-title col-lg-5 mx-3 p-2 text-white d-flex flex-column justify-content-around">
              <div class="brand-fav d-flex justify-content-between my-1">
                <h6 class="fw-bold"><%=productDetails.brand%></h6>
                
            
                    <button class="bg-transparent border-0" id="wishlistHeart" onclick="addToWishlist('<%=productDetails._id%>')"><i class="fa fa-heart <%if(productExistInWishlist==null){%>text-white<%}else{%>text-danger<%}%>"></i></button>
          
                <script>
                  function addToWishlist(productId){
                    $.ajax({
                      url: '/users/wishlist',
                      method: 'patch',
                      data: {
                        id : productId 
                      },
                      success: (res) => {

                          if (res.data.message===0) {
                          $('#wishlistHeart').html('<i class="fa fa-heart text-white">')
                            Swal.fire({
                            toast: true,
                            icon: 'error',
                            position: 'top-right',
                            showConfirmButton: false,
                            timer: 1000,
                            timerProgressBar: true,
                            animation: true,
                            title: 'Removed from wishlist'})
                        } else if(res.data.message===1) {
                          $('#wishlistHeart').html('<i class="fa fa-heart text-danger">')
                            Swal.fire({
                            toast: true,
                            icon: 'success',
                            position: 'top-right',
                            showConfirmButton: false,
                            timer: 1000,
                            timerProgressBar: true,
                            animation: true,
                            title: 'Added to wishlist'})
                        } else{
                          window.location.href = "/users/signIn";
                        }
                      }
                    })
                  }
                </script>
              </div>
              <h3 class="fw-light shadow-product-heading"><%=productDetails.name%></h3>
              <p class="shadow-details">Price: ‚Çπ <%=productDetails.price%></p>
              <div class="model-case d-flex">
                <p class="w-50 shadow-details">Model Case:</p>
                <p class="w-50 shadow-details"><%=productDetails.modelCase%></p>
              </div>
              <div class="buy-cart row text-center justify-content-around p-0">
                  <div class="button-div rounded col-5 border p-2  d-flex align-items-center justify-content-center" >
                    <span style="font-size: 0.8rem;">Buy Now</span>
                  </div>
                  <div class="button-div rounded col-5 border p-2  d-flex align-items-center justify-content-center" onclick="addToCart('<%=productDetails._id%>')">
                  <span style="font-size: 0.8rem;">Add to cart</span>
                  <script>
                    function addToCart(productID){
                    $.ajax({
                      url: '/users/cart',
                      method: 'post',
                      data: {
                        id : productID 
                      },
                      success: (res) => {
                          if (res.success==='countAdded') {
                              Swal.fire({
                              toast: true,
                              icon: 'success',
                              position: 'top-right',
                              showConfirmButton: false,
                              timer: 1000,
                              timerProgressBar: true,
                              animation: true,
                              title: 'Count added in cart'})    
                         } else if(res.success==='addedToCart') {
                               Swal.fire({
                              toast: true,
                              icon: 'success',
                              position: 'top-right',
                              showConfirmButton: false,
                              timer: 1000,
                              timerProgressBar: true,
                              animation: true,
                              title: 'Added to cart'})
                        } else{
                              window.location.href = "/users/signIn";
                        }
                      }
                    })
                  }
                  </script>
                  <!-- /users/cart/addToCart/<%=productDetails._id%> -->
<!-- <button class="bg-transparent border-0">Add to cart</button> -->
                  </div>
              </div>
            </div>
          </div>
        </div>
        <div class="product-description mt-2 mb-5 container text-center">
        <div id="description">
          <div class="row my-3 justify-content-around">
            <div class="col-3 d-flex flex-column">
              <div class="description-heading">
                <h6 class="fw-bold">Reference</h6>
                <p><%=productDetails.referenceNumber%></p>
              </div>
            </div>
            <div class="col-3 d-flex flex-column">
              <div class="description-heading">
                <h6 class="fw-bold">Model Case</h6>
                <p><%=productDetails.modelCase%></p>
              </div>
            </div>
        <div class="col-3 d-flex flex-column">
          <div class="description-heading">
            <h6 class="fw-bold">Water Resistance</h6>
            <p><%=productDetails.waterResistance%></p>
          </div>
        </div>
        </div>
        <div class="row my-3 justify-content-around">
          <div class="col-3 d-flex flex-column">
            <div class="description-heading">
              <h6 class="fw-bold">Movement</h6>
              <p><%=productDetails.movement%></p>
            </div>
          </div>
          <div class="col-3 d-flex flex-column">
            <div class="description-heading">
              <h6 class="fw-bold">Power Reserve</h6>
              <p><%=productDetails.powerReserve%></p>
            </div>
          </div>
      <div class="col-3 d-flex flex-column">
        <div class="description-heading">
          <h6 class="fw-bold">Bracelet</h6>
          <p><%=productDetails.bracelet%></p>
        </div>
      </div>
        </div>
        </div>
       
        <!-- Carousel -->
        <div id="carouselIndicators" class="container rounded carousel carousel-dark slide my-5 w-75" data-bs-ride="true">
        <div class="carousel-indicators">
          <button type="button" data-bs-target="#carouselIndicators" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
          <button type="button" data-bs-target="#carouselIndicators" data-bs-slide-to="1" aria-label="Slide 2"></button>
          <button type="button" data-bs-target="#carouselIndicators" data-bs-slide-to="2" aria-label="Slide 3"></button>
        </div>
        <div class="carousel-inner">
          <div class="carousel-item active">
            <img src="../../public/img/products/<%=productDetails.images[0]%>" class="d-block w-100" alt="...">
          </div>
          <div class="carousel-item">
            <img src="../../public/img/products/<%=productDetails.images[1]%>" class="d-block w-100" alt="...">
          </div>
          <div class="carousel-item">
            <img src="../../public/img/products/<%=productDetails.images[2]%>" class="d-block w-100" alt="...">
          </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#carouselIndicators" data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carouselIndicators" data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Next</span>
        </button>
        </div>
<!-- Add reviews -->
<!-- <form action="/users/reviews" method="post">
  <div class="mb-3">
    <label for="review" class="form-label">Title</label>
    <input type="text" name="review" class="form-control" id="review" >
  </div>
  <div class="mb-3">
    <div class="review-star">
      <input type="checkbox" name="star" id="st1" value="5" />
      <label for="st1"></label>
      <input type="checkbox" name="star" id="st2" value="4" />
      <label for="st2"></label>
      <input type="checkbox" name="star" id="st3" value="3" />
      <label for="st3"></label>
      <input type="checkbox" name="star" id="st4" value="2" />
      <label for="st4"></label>
      <input type="checkbox" name="star" id="st5" value="1" />
      <label for="st5"></label>
    </div>
  </div>
  <button type="submit" class="btn btn-sm btn-dark">Submit</button>
</form> -->

<script>
  
  function reviewAdd(){
    Swal.fire({
      showCloseButton: true,
      showConfirmButton: true,
html: `<form id="reviewForm">
  <div class="mb-3">
    <label for="review" class="form-label">Post a review</label>
    <input name="review" class="form-control" id="review pattern='^[A-Z]{1,30}$" >
  </div>
  <input type="text" name="product" value='<%=productDetails._id%>' hidden>
  <div class="mb-3">
    <div class="review-star">
      <input type="checkbox" name="rating" id="st1" value="5" />
      <label for="st1"></label>
      <input type="checkbox" name="rating" id="st2" value="4" />
      <label for="st2"></label>
      <input type="checkbox" name="rating" id="st3" value="3" />
      <label for="st3"></label>
      <input type="checkbox" name="rating" id="st4" value="2" />
      <label for="st4"></label>
      <input type="checkbox" name="rating" id="st5" value="1" />
      <label for="st5"></label>
    </div>
  </div>
</form>`
}).then((result) => {
  if(result.isConfirmed){
    $.ajax({
      url: '/users/reviews',
      method: 'post',
      data: $('#reviewForm').serialize(),
      success: (res) => {
        $('section').load(location.href + " section")
        $("#addReview").hide()
      }
    })
  }
})
  }
</script>
<!-- Review Carousel -->
<%if(reviews!=null){%>
<div class="container" id="reviewContainer">
  <% if (numberOfReviews!=null){%> <h6 class="text-center mx-auto col-lg-10">Reviews - (<%=numberOfReviews%>)</h6><%}%>
  </div>
    <div class="container d-flex justify-content-center">
      <div class="row carousal-row">
          <div id="carouselExampleControls" class="carousel carousel-dark slide" data-bs-ride="carousel">
              <div class="carousel-inner">
                <div class="carousel-item active">
                  <div class="cards-wrapper card_wrap">
                      <div class="card cardMargin">
                        <div class="card-body">
                          
                          <div class=" text-center" style="position: relative;">
                            <span>
                              <% for( i=1; i<=5; i++){ %>
                                <%if(i<=reviews[0].rating){%>
                                <span style="color: yellow">‚òÖ</span>
                                <%}else{%>
                                  <span style="color: gray">‚òÖ</span>
                              <%}}%>
                            </span>
                            <span id="helpful<%=reviews[0]._id%>" style=" position: absolute; right: 0;">
                              <button onclick="helpful('<%=reviews[0]._id%>')" class="btn btn-sm rounded" style="background-color: #f3f3f3;"><%=reviews[0].helpful%> üëç</button>
                            </span>
                          </div>
                          <h6 class="my-1 card-title"><%=reviews[0].review%></h6>
                          <div>
                            <p class="card-text" style="font-size: 0.65rem"><%=reviews[0].customer.name%></p>
                          <img src="/public/img/users/<%=reviews[0].customer.photo%>" class="card-img-top w-25 rounded-2" alt="..."></a>
                          </div>
                          </div>
                        </div>
                        <%if(reviews[1]){%>
                        <div class="card cardMargin">
                          <div class="card-body">
                            <div class=" text-center" style="position: relative;">
                              <span>
                                <% for( i=1; i<=5; i++){ %>
                                  <%if(i<=reviews[1].rating){%>
                                  <span style="color: yellow">‚òÖ</span>
                                  <%}else{%>
                                    <span style="color: gray">‚òÖ</span>
                                <%}}%>
                              </span>
                              <span id="helpful<%=reviews[1]._id%>" style=" position: absolute; right: 0;">
                                <button onclick="helpful('<%=reviews[1]._id%>')" class="btn btn-sm rounded" style="background-color: #f3f3f3;"><%=reviews[1].helpful%> üëç</button>
                              </span>
                            </div>
                            <h6 class="my-1 card-title"><%=reviews[1].review%></h6>
                            <p class="card-text" style="font-size: 0.65rem"><%=reviews[1].customer.name%></p>
                            <img src="/public/img/users/<%=reviews[1].customer.photo%>" class="card-img-top w-25 rounded-2" alt="..."></a>
                           </div>
                         </div>
                         <%}%>
                        <%if(reviews[2]){%>

                         <div class="card cardMargin">
                           <div class="card-body">
                            <div class=" text-center" style="position: relative;">
                              <span>
                                <% for( i=1; i<=5; i++){ %>
                                  <%if(i<=reviews[2].rating){%>
                                  <span style="color: yellow">‚òÖ</span>
                                  <%}else{%>
                                    <span style="color: gray">‚òÖ</span>
                                <%}}%>
                              </span>
                              <span id="helpful<%=reviews[2]._id%>" style=" position: absolute; right: 0;">
                                <button onclick="helpful('<%=reviews[2]._id%>')" class="btn btn-sm rounded" style="background-color: #f3f3f3;"><%=reviews[2].helpful%> üëç</button>
                              </span>
                            </div>
                             <h6 class="my-1 card-title"><%=reviews[2].review%></h6>
                             <p class="card-text" style="font-size: 0.65rem"><%=reviews[2].customer.name%></p>
                             <img src="/public/img/users/<%=reviews[2].customer.photo%>" class="card-img-top w-25 rounded-2" alt="..."></a>
                           </div>
                         </div>
                         <%}%>

                  </div>
          
                </div>
                <div class="carousel-item ">
                    <div class="cards-wrapper card_wrap">
                        <% for(var i=3; i<=6; i++){%>
                          <%if(reviews[i]!=null){%>
                          <div class="card cardMargin">
                            <div class="card-body">
                              <div class=" text-center" style="position: relative;">
                                <span>
                                  <% for( j=1; j<=5; j++){ %>
                                    <%if(i<=reviews[i].rating){%>
                                    <span style="color: yellow">‚òÖ</span>
                                    <%}else{%>
                                      <span style="color: gray">‚òÖ</span>
                                  <%}}%>
                                </span>
                                <span id="helpful<%=reviews[i]._id%>" style=" position: absolute; right: 0;">
                                  <button onclick="helpful('<%=reviews[i]._id%>')" class="btn btn-sm rounded" style="background-color: #f3f3f3;"><%=reviews[i].helpful%> üëç</button>
                                </span>
                              </div>
                              <h6 class="card-title"><%=reviews[i].review%></h6>
                              <p class="card-text" style="font-size: 0.65rem"><%=reviews[i].customer.name%></p>
                              <img src="/public/img/users/<%=reviews[i].customer.photo%>" class="card-img-top w-25 rounded-2" alt="...">
                            </div>
                          </div>
                          <%}%>
                            <%}%>
                      </div>
                    </div>
              </div>
          <script>
            function helpful(id){
              $.ajax({
                url: '/users/reviews',
                method: 'patch',
                data: {
                  reviewID : id
                },
                success: (res) => {
if (res.success==1) {
  $('#helpful'+id).load(location.href + " #helpful"+id)
}else{
  window.location.replace("/users/signIn")
}
                }
              })
            }
          </script>
              <button class="carousel-control-prev" id="reviewButtomLeft" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="prev">
                <span class="carousel-control-prev-icon carousel-arrow" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
              </button>
              <button class="carousel-control-next" id="reviewButtomRight" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="next">
                <span class="carousel-control-next-icon carousel-arrow" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
              </button>
            </div>
      </div>
      
    </div>
<%}%>
  <%if(session){%>
    <button class=" btn btn-sm btn-dark mb-3 col-lg-2 mb-4" id="addReview" onclick="reviewAdd()">Add a review</button>
  <%}%> 
         <!-- Still Need any help -->
        <div class="still-help" style="font-size: 0.75rem;">
        <p><span class="fw-bold">Still need any help?</span> Our executive will help you in making the choice.</p>
        <h6 class="fw-bold text-underline"><u><a href="" style="font-size: 0.75rem;">Contact executive</a></u></h6>
         </div>
    </section>
    <%}%>
    <footer class="bg-theme">
      <div
        class="container links pt-4 pb-2 row mx-auto line-break d-flex justify-content-around"
      >
        <a class="col-lg-2 pb-2 text-center" href="#">Track Shipping</a>
        <a class="col-lg-2 pb-2 text-center" href="#">Contact Us</a>
        <a class="col-lg-2 pb-2 text-center" href="#">Customer Care</a>
        <a class="col-lg-2 pb-2 text-center" href="#">About us</a>
        <span class="col-lg-2 justify-content-center d-flex align-items-center">
          <i class="fab fa-instagram"></i>
          <i class="fab fa-facebook-f"></i>
          <i class="fab fa-twitter"></i>
          <i class="fab fa-whatsapp"></i>
        </span>
      </div>
      <div class="copyright bg-theme py-2 text-center">
        <span>Copyright ¬© 2022 | Timeless | Made by <a href="https://muhamedshahabas.github.io/">Muhamed Shahabas C</a></span>

      </div>
    </footer>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
      crossorigin="anonymous"
    ></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  </body>
</html>
